# ReqParser 需求差距分析报告

> 生成日期：2026-02-08
> 对照文档：Req.md (需求说明书) + Tech.md (技术说明书)
> 代码基线：src-tauri/src/ 下全部 Rust 源文件 + src/App.tsx 前端最小测试 UI

---

## 一、已完成功能清单

### 1. 核心解析引擎 (Phase 1)

| # | 功能 | 完成度 | 说明 |
|---|------|--------|------|
| 1.1 | 自动识别输入格式 (cURL / fetch / 原始 HTTP) | 100% | `detector.rs` 通过前缀匹配和正则实现三格式自动检测 |
| 1.2 | 原始 HTTP Request 解析 | 100% | `parser.rs` - 支持请求行、headers、body 分离 |
| 1.3 | 原始 HTTP Response 解析 | 100% | `parser.rs` - 支持状态行、status code/text |
| 1.4 | 纯 Headers 解析 | 100% | `parser.rs` - HeadersOnly 类型，自动降级 |
| 1.5 | cURL 命令解析 | 100% | `curl_parser.rs` - 支持 -H/-b/-X/-d/--data-raw/续行/shell 引号 |
| 1.6 | fetch() 调用解析 | 100% | `fetch_parser.rs` - 支持 URL、headers、body、method |
| 1.7 | URL Query Params 解析 | 100% | 三个 parser 都实现了 URL 查询参数拆解和 URL 解码 |
| 1.8 | Cookie / Set-Cookie 子解析 | 100% | 三个 parser 都实现了 Cookie 按 `;` 拆解为 children |
| 1.9 | ParseNode 树形数据模型 | 100% | `models.rs` - 含 key/value/children/description |
| 1.10 | 错误类型体系 | 100% | `error.rs` - thiserror + 手动 Serialize |

### 2. 剪贴板监听 (Phase 1)

| # | 功能 | 完成度 | 说明 |
|---|------|--------|------|
| 2.1 | 剪贴板后台轮询监听 | 100% | `clipboard.rs` - 500ms 间隔，arboard + spawn_blocking |
| 2.2 | HTTP 文本自动检测 | 100% | 检测到 HTTP 特征文本时发出事件 |
| 2.3 | 开关控制 | 100% | `toggle_clipboard_watcher` / `get_clipboard_watcher_status` 命令 |
| 2.4 | Tauri Event 通知前端 | 100% | `clipboard-http-detected` 事件 |

### 3. 前端 (最小测试 UI)

| # | 功能 | 完成度 | 说明 |
|---|------|--------|------|
| 3.1 | 文本输入区 | 100% | textarea 组件 |
| 3.2 | 解析按钮 + JSON dump 展示 | 100% | 结果以 JSON.stringify 展示 |
| 3.3 | 剪贴板监听开关 UI | 100% | 按钮切换 + 状态显示 |
| 3.4 | 剪贴板事件自动解析 | 100% | 监听 `clipboard-http-detected` 事件并自动解析 |

### 4. 测试

| # | 功能 | 完成度 | 说明 |
|---|------|--------|------|
| 4.1 | parser.rs 单元测试 | 100% | 10 个测试用例 |
| 4.2 | curl_parser.rs 单元测试 | 100% | 15 个测试用例 |
| 4.3 | fetch_parser.rs 单元测试 | 100% | 11 个测试用例 |
| 4.4 | detector.rs 单元测试 | 100% | 14 个测试用例 |

### 5. 工程基础

| # | 功能 | 完成度 | 说明 |
|---|------|--------|------|
| 5.1 | Tauri v2 项目骨架 | 100% | 含 tauri_plugin_opener |
| 5.2 | CI/CD 工作流 | 100% | 跨平台 CI/CD workflow |
| 5.3 | serde camelCase 序列化 | 100% | JS-friendly JSON key 命名 |

---

## 二、未完成功能清单（按 Phase 分组）

### Phase 2: 递归解析引擎 (Parser Engine)

| # | 需求项 | 来源 | 优先级 | 复杂度 | 依赖 | 验收标准 |
|---|--------|------|--------|--------|------|----------|
| P2-01 | **复合 Value 递归解析** | Req 2.1 | P0 | 中 | 无 | 识别 Value 中 `k1=v1&k2=v2` 和 `k1:v1;k2:v2` 格式并展开为 children（如 `x-www-form-urlencoded`） |
| P2-02 | **JWT 自动检测与解析** | Req 2.2 | P0 | 中 | 无 | 正则 `^[a-zA-Z0-9_-]+\.[a-zA-Z0-9_-]+\.[a-zA-Z0-9_-]+$` 匹配 JWT 格式的 Value，自动 Base64 解码 Header 和 Payload 为 JSON children |
| P2-03 | **时间戳自动转换** | Req 2.2 | P1 | 低 | 无 | 识别纯数字 Value（10 位或 13 位），展示本地时间转换结果（如 `1770480000` -> `2026-02-08 00:00:00 +08:00`） |
| P2-04 | **URL 编解码** | Req 2.2 | P1 | 低 | 无 | 自动检测 URL 编码字符（`%XX`），在解析结果中同时展示原始值和解码值 |
| P2-05 | **Base64 编解码** | Req 2.2 | P1 | 低 | 无 | 自动检测 Base64 编码字符串，解码后展示可读内容；对于 Base64 包含的 JSON 进一步格式化 |
| P2-06 | **JSON 格式化** | Req 2.2 | P0 | 低 | 无 | 对 body 中压缩的 JSON 进行高亮美化展示，支持嵌套层级折叠/展开 |
| P2-07 | **Content-Type 感知解析** | Tech 3.1 | P1 | 中 | P2-01 | 根据 `Content-Type` header 选择 body 的解析策略（JSON 格式化 / form-urlencoded 拆解 / 纯文本） |

### Phase 3: 完整 UI/UX

| # | 需求项 | 来源 | 优先级 | 复杂度 | 依赖 | 验收标准 |
|---|--------|------|--------|--------|------|----------|
| P3-01 | **三栏布局** | Req 5 | P0 | 高 | 无 | 左侧输入/历史列表、中间 K-V 主展示区、右侧详情面板 |
| P3-02 | **K-V 树形表格组件** | Req 2.1, Tech 4.1 | P0 | 高 | P2-01 | 表格列：Key / Value / Action；支持嵌套展开/收起；Hover 展示字段描述浮窗 |
| P3-03 | **点击 Key 快速复制** | Req 2.1 | P1 | 低 | P3-02 | 点击 Key 列自动复制 Key 到剪贴板 |
| P3-04 | **点击 Value 切换原始/美化值** | Req 2.1 | P1 | 中 | P3-02 | 点击 Value 可在原始值和解码/格式化后的值之间切换 |
| P3-05 | **右侧详情面板** | Req 5, Tech 4.3 | P0 | 高 | P3-02, P4-01 | 展示选中字段的官方定义、MDN 链接、解码后完整内容、安全风险提示 |
| P3-06 | **顶部工具栏** | Req 5 | P0 | 中 | 无 | 粘贴按钮、清空按钮、监听开关、Diff 模式切换、截图脱敏开关 |
| P3-07 | **历史记录列表** | Req 5 | P2 | 中 | 无 | 左侧展示已解析的历史请求列表，可点击切换查看 |
| P3-08 | **Quick Action Bar** | Tech 4.2 | P1 | 中 | P2-04, P2-05, P2-03 | Base64 Decode 切换、Time Transformer、URL 解码切换 |
| P3-09 | **多标签页/多窗口** | Req 3 | P2 | 高 | P3-01 | 同时解析多个请求，支持标签页切换 |

### Phase 4: 智能功能与效率增强

| # | 需求项 | 来源 | 优先级 | 复杂度 | 依赖 | 验收标准 |
|---|--------|------|--------|--------|------|----------|
| P4-01 | **内置百科词典 (dictionary.json)** | Req 2.1, Tech 3.2 | P0 | 中 | 无 | 维护 `zh-CN.json`，包含所有标准 HTTP Header 的中文解释及各值含义（如 `Cache-Control` 的 `no-cache`/`max-age`）；渲染时通过 Key 查询并显示 |
| P4-02 | **自定义 Header 智能推测** | Req 2.1 | P2 | 高 | P4-01 | 对非标准自定义 Header（如 `X-Request-Id`）提供"可能作用"的推测说明 |
| P4-03 | **Diff 对比模式** | Req 2.3 | P1 | 高 | P3-02 | 双窗口对比两段 Header/Payload 差异，高亮不同点 |
| P4-04 | **代码片段生成** | Req 2.3 | P1 | 中 | 无 | 将解析结果一键导出为 cURL / Fetch / Python / Go 代码 |
| P4-05 | **敏感数据遮罩 (Privacy Mask)** | Req 2.3, Tech 6 | P0 | 中 | P3-02 | 一键对 Authorization/Token/Set-Cookie 等敏感字段脱敏，按 Key 黑名单自动模糊 Value，方便截图分享 |
| P4-06 | **安全风险提示** | Tech 4.3 | P2 | 中 | P4-01, P3-05 | 在侧边面板提示安全风险（如 Cookie 缺少 HttpOnly 标志） |

### 系统集成与交互

| # | 需求项 | 来源 | 优先级 | 复杂度 | 依赖 | 验收标准 |
|---|--------|------|--------|--------|------|----------|
| S-01 | **系统托盘 / 悬浮窗提示** | Req 3 | P1 | 中 | 2.1-2.4 已完成 | 剪贴板检测到 HTTP 文本后，通过系统托盘或悬浮窗提示"一键解析" |
| S-02 | **始终置顶模式** | Req 3 | P2 | 低 | 无 | 窗口支持 "始终置顶" 开关 |
| S-03 | **全局快捷键** | Req 3 | P1 | 中 | 无 | 支持全局快捷键（如 `Option + Space`）快速调出界面 |
| S-04 | **macOS Menubar 集成** | Tech 5 | P2 | 高 | S-01 | macOS 下支持 Menubar 模式运行 |
| S-05 | **macOS 毛玻璃效果** | Tech 5 | P2 | 中 | 无 | macOS 支持 Vibrancy 毛玻璃窗口效果 |

### 非功能性需求

| # | 需求项 | 来源 | 优先级 | 复杂度 | 依赖 | 验收标准 |
|---|--------|------|--------|--------|------|----------|
| NF-01 | **零服务器隐私保证** | Req 4 | P0 | 低 | 无 | 确保 `tauri.conf.json` 中 allowlist 严格配置，禁止业务数据外流 |
| NF-02 | **启动性能 < 1s** | Req 4 | P1 | 低 | 无 | 启动时间控制在 1 秒以内 |
| NF-03 | **万级行数无卡顿** | Req 4 | P1 | 中 | P3-02 | 处理万级行数 Payload 时界面不卡顿（虚拟滚动 / Web Worker） |
| NF-04 | **安装包 < 10MB** | Req 4 | P1 | 低 | 无 | Tauri 构建产物体积控制在 10MB 左右 |
| NF-05 | **历史记录本地加密存储** | Tech 6 | P2 | 中 | P3-07 | 历史记录可选加密存储（Local Storage / JSON File） |
| NF-06 | **跨平台适配** | Tech 5 | P1 | 中 | 无 | Windows 字体优化（微软雅黑/Segoe UI）、Linux AppImage 分发、GTK 兼容 |

---

## 三、需求覆盖矩阵

### Req.md 覆盖情况

| 需求章节 | 总需求数 | 已完成 | 未完成 | 覆盖率 |
|----------|----------|--------|--------|--------|
| 2.1 智能解析引擎 | 6 | 2 | 4 | 33% |
| 2.2 自动解码与转换 | 4 | 0 | 4 | 0% |
| 2.3 效率增强功能 | 3 | 0 | 3 | 0% |
| 3 交互与系统集成 | 4 | 1 | 3 | 25% |
| 4 非功能性需求 | 3 | 0 | 3 | 0% |
| 5 界面原型 | 4 | 0 | 4 | 0% |
| **合计** | **24** | **3** | **21** | **12.5%** |

> 注：已完成项指「自动识别」「Cookie 解析」「剪贴板监听后台运行」，其余均为部分完成或未开始。

### Tech.md 覆盖情况

| 技术章节 | 总项数 | 已完成 | 未完成 | 覆盖率 |
|----------|--------|--------|--------|--------|
| 3.1 解析引擎逻辑 | 3 | 1 | 2 | 33% |
| 3.2 内置百科实现 | 1 | 0 | 1 | 0% |
| 3.3 剪贴板监听 | 1 | 1 | 0 | 100% |
| 4 UI 组件设计 | 3 | 0 | 3 | 0% |
| 5 跨平台适配 | 3 | 0 | 3 | 0% |
| 6 安全性规范 | 3 | 0 | 3 | 0% |

---

## 四、推荐实施顺序

### 第一阶段（P0 核心功能）

建议按以下顺序实施，确保每个步骤的依赖已就绪：

```
1. P4-01  内置百科词典 (dictionary.json)      [无依赖，可先行]
2. P2-01  复合 Value 递归解析                   [无依赖]
3. P2-02  JWT 自动检测与解析                    [无依赖]
4. P2-06  JSON 格式化                           [无依赖]
5. P3-01  三栏布局                              [无依赖]
6. P3-02  K-V 树形表格组件                      [依赖 P2-01]
7. P3-05  右侧详情面板                          [依赖 P3-02, P4-01]
8. P3-06  顶部工具栏                            [无依赖]
9. P4-05  敏感数据遮罩                          [依赖 P3-02]
10. NF-01 零服务器隐私保证                      [配置检查]
```

### 第二阶段（P1 增强功能）

```
11. P2-03  时间戳自动转换
12. P2-04  URL 编解码
13. P2-05  Base64 编解码
14. P2-07  Content-Type 感知解析
15. P3-03  点击 Key 快速复制
16. P3-04  点击 Value 切换原始/美化值
17. P3-08  Quick Action Bar
18. P4-03  Diff 对比模式
19. P4-04  代码片段生成
20. S-01   系统托盘/悬浮窗提示
21. S-03   全局快捷键
22. NF-02  启动性能优化
23. NF-03  大数据量无卡顿
24. NF-04  安装包体积控制
25. NF-06  跨平台适配
```

### 第三阶段（P2 锦上添花）

```
26. P3-07  历史记录列表
27. P3-09  多标签页/多窗口
28. P4-02  自定义 Header 智能推测
29. P4-06  安全风险提示
30. S-02   始终置顶模式
31. S-04   macOS Menubar 集成
32. S-05   macOS 毛玻璃效果
33. NF-05  历史记录本地加密存储
```

---

## 五、技术风险提示

| 风险项 | 描述 | 建议缓解方案 |
|--------|------|--------------|
| 递归解析深度 | 嵌套编码（如 Base64 内含 JWT 内含 JSON）可能导致无限递归 | 设置最大递归深度限制（如 5 层） |
| JWT 解码安全 | 需要明确 JWT 只做 Base64 解码，不做签名验证 | 文档说明仅展示解码内容，不验证签名 |
| 万级行数性能 | K-V 树形表格渲染大量节点可能卡顿 | 使用虚拟滚动（react-window / tanstack-virtual） |
| 跨平台剪贴板 | arboard 在 Wayland 下可能有兼容问题 | 关注 arboard issue tracker，备选 wl-clipboard |
| 全局快捷键冲突 | `Option + Space` 可能与系统或其他应用冲突 | 提供用户自定义快捷键设置 |
| Cookie 解析重复 | 三个 parser 中 Cookie/query_params 解析逻辑重复 | 提取为共用模块，减少维护成本 |

---

## 六、代码层面已发现问题

| # | 问题 | 位置 | 建议 |
|---|------|------|------|
| 1 | Cookie/query_params 解析逻辑在 `parser.rs`、`curl_parser.rs`、`fetch_parser.rs` 中重复实现 | 三个文件 | 提取到共用工具模块 |
| 2 | `ParseNode.description` 字段始终为 `None` | `models.rs:13` | Phase 4 实现词典后填充 |
| 3 | 前端 TypeScript 类型定义与 Rust 模型手动同步 | `App.tsx:5-23` | 考虑使用 `ts-rs` 或 `specta` 自动生成 TypeScript 类型 |
| 4 | 剪贴板监听事件名硬编码 | `clipboard.rs:38`, `App.tsx:33` | 定义为常量避免不一致 |
